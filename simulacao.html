<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simula√ß√£o | Paz Solar</title>
<style>
:root { --blue-dark: rgb(20,100,130); --error: #d32f2f; }
* { box-sizing: border-box; font-family: Arial, sans-serif; }
body { margin: 0; }
nav { position: absolute; top: 20px; right: 30px; z-index: 10; }
nav a { color: white; text-decoration: none; font-weight: bold; background: rgba(0,0,0,0.4); padding: 10px 18px; border-radius: 6px; }
.hero { height: 50vh; background: url("img/solar.jpg") center/contain no-repeat; background-color: #000; }
.section { padding: 80px 10%; }
.section h2 { text-align: center; font-size: 2.6rem; margin-bottom: 50px; }
form { max-width: 700px; margin: auto; }
input, select { width: 100%; padding: 16px; margin-bottom: 20px; font-size: 1.1rem; border: 2px solid #ccc; border-radius: 6px; }
input.error, select.error { border-color: var(--error); background: #ffecec; }
button { width: 100%; padding: 18px; font-size: 1.3rem; font-weight: bold; background: var(--blue-dark); color: white; border: none; border-radius: 8px; cursor: pointer; }
button:disabled { background: #ccc; cursor: not-allowed; }
.lgpd { font-size: 0.95rem; margin-top: 10px; margin-bottom: 20px; }
.lgpd label { display: flex; align-items: center; gap: 10px; cursor: pointer; }
.lgpd input { width: auto; margin-bottom: 0; }
#error-msg { display: none; margin-top: 20px; color: var(--error); font-size: 1.2rem; text-align: center; font-weight: bold; }
#resultado { display: none; margin-top: 50px; text-align: center; font-size: 2rem; font-weight: bold; color: var(--error); }
@media (max-width: 768px) { .section { padding: 50px 6%; } .section h2 { font-size: 2rem; } }
</style>
</head>
<body>
<nav><a href="index.html">P√°gina inicial</a></nav>
<section class="hero"></section>
<section class="section">
  <h2>Simula√ß√£o da sua conta!</h2>
  <form id="formSimulacao">
    <input type="tel" id="telefone" placeholder="Telefone de contato">
    <input type="number" id="consumo" placeholder="Consumo m√©dio em kWh (12 meses)">
    <input type="number" step="0.01" id="taxa" placeholder="Taxa de Ilumina√ß√£o P√∫blica (R$)">
    <input type="text" id="municipio" placeholder="Munic√≠pio">
    <select id="fase">
      <option value="">Selecione a fase da unidade</option>
      <option value="Monof√°sica">Monof√°sica</option>
      <option value="Trif√°sica">Trif√°sica</option>
    </select>
    <div class="lgpd">
      <label><input type="checkbox" id="lgpd"> Li e concordo com a <a href="privacidade.html" target="_blank">Pol√≠tica de Privacidade</a>.</label>
    </div>
    <button type="button" id="btnEnviar" onclick="processarDados()">Processar seus dados</button>
    <div id="error-msg">Por favor, preencha todos os campos e aceite a Pol√≠tica de Privacidade!</div>
  </form>
  <div id="resultado"></div>
</section>

<script>
// üî¥ COLE AQUI A URL DO SEU APPS SCRIPT
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwwAKtNuG2-x5KAX3xdNBwQzOKc5g0AkfyrGuqs1q3E-e1lB9xCzvOfjNLa9vYbQTw1bw/exec";

function processarDados() {
  const btn = document.getElementById("btnEnviar");
  const campos = ["telefone", "consumo", "taxa", "municipio", "fase"];
  let erro = false;

  campos.forEach(id => {
    const el = document.getElementById(id);
    el.classList.remove("error");
    if (!el.value || el.value <= 0) { el.classList.add("error"); erro = true; }
  });

  if (!document.getElementById("lgpd").checked) erro = true;

  const errorMsg = document.getElementById("error-msg");
  if (erro) { errorMsg.style.display = "block"; return; }
  errorMsg.style.display = "none";

  btn.disabled = true;
  btn.innerText = "Enviando...";

  const telVal = document.getElementById("telefone").value;
  const munVal = document.getElementById("municipio").value;
  const consumoVal = parseFloat(document.getElementById("consumo").value);
  const taxaVal = parseFloat(document.getElementById("taxa").value);
  const faseVal = document.getElementById("fase").value;
  
  const resultadoFinal = (Math.ceil(consumoVal / 78) * 78 * 0.53) + (consumoVal * 0.2115) + taxaVal;
  const resFormatado = resultadoFinal.toLocaleString("pt-BR", { minimumFractionDigits: 2, maximumFractionDigits: 2 });

  document.getElementById("resultado").innerHTML = `Seu novo custo mensal simulado √© de R$ ${resFormatado}`;
  document.getElementById("resultado").style.display = "block";

  // Corre√ß√£o do envio: Usando URLSearchParams corretamente para preencher todas as colunas
  const params = new URLSearchParams();
  params.append("telefone", telVal);
  params.append("consumo", consumoVal);
  params.append("taxa", taxaVal);
  params.append("municipio", munVal);
  params.append("fase", faseVal);
  params.append("resultado", resFormatado);

  fetch(SCRIPT_URL, { 
    method: "POST", 
    mode: "no-cors", 
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: params.toString() 
  })
  .then(() => {
    const msg = `Ol√°! Fiz uma simula√ß√£o na Paz Solar üòä\n\nTelefone: ${telVal}\nMunic√≠pio: ${munVal}\nConsumo: ${consumoVal} kWh\nüí° Valor: R$ ${resFormatado}`;
    // Corre√ß√£o: Abre o WhatsApp em uma NOVA ABA
    window.open("https://wa.me/5584996710787?text=" + encodeURIComponent(msg), "_blank");
    btn.disabled = false;
    btn.innerText = "Processar seus dados";
  })
  .catch(() => { 
    const msg = `Ol√°! Fiz uma simula√ß√£o na Paz Solar üòä\n\nTelefone: ${telVal}\nMunic√≠pio: ${munVal}\nConsumo: ${consumoVal} kWh\nüí° Valor: R$ ${resFormatado}`;
    window.open("https://wa.me/5584996710787?text=" + encodeURIComponent(msg), "_blank");
    btn.disabled = false;
    btn.innerText = "Processar seus dados";
  });
}
</script>
</body>
</html>
